@page "/create"
@using flashcard.Data
@using Microsoft.AspNetCore.Components.Authorization
@using flashcard.model
@using flashcard.utils
@inject FlashCardService FlashCardService
@inject NavigationManager Navigation
@rendermode InteractiveServer

<PageTitle>Create a Flashcard</PageTitle>
<div class="flex flex-col py-10 max-w-xl mx-auto gap-3">
	<div class="form-control w-full">
		<div class="label">
			<span class="label-text">Deck name</span>
		</div>
		<input type="text" placeholder="Type deck name" class="input input-bordered w-full rounded-lg"
		       @bind="DeckName"/>
	</div>
	<div class="form-control w-full">
		<div class="label">
			<span class="label-text">Deck description</span>
		</div>
		<input type="text" placeholder="Type deck name" class="input input-bordered w-full rounded-lg"
		       @bind="DeckDescription"/>
	</div>
	<div class="form-control w-full">
		<div class="label">
			<span class="label-text">Deck category</span>
		</div>
		<select class="select select-bordered rounded-lg max-[480px]:w-full" @bind="SelectedCategory">
			<option disabled selected>Select Category</option>
			@foreach (var category in Category.GetCategoriesExceptAll())
			{
				<option value="@category.Value">@category.DisplayName</option>
			}
		</select>
	</div>
	<div class="pt-2 w-full">
		<button class="btn rounded-lg w-full" onclick="aaaaaa.showModal()">Add Card</button>
		<div class="overflow-x-auto">
			<table class="table table-auto">
				<thead>
				<tr>
					<th></th>
					<th>Del</th>
					<th>Question</th>
					<th>Answer</th>
				</tr>
				</thead>
				<tbody>
				@for (var i = 0; i < flashCardProblems.Count; i++)
				{
					var problem = flashCardProblems[i];
					var currentIndex = i;
					<tr class="hover">
						<th>@(i + 1)</th>
						<td>
							<div class="cursor-pointer bg-transparent"
							     @onclick="() => DeleteFlashCardProblem(currentIndex)">
								<flashcard.Components.Icon.IconDelete/>
							</div>
						</td>
						<td class="truncate">@problem.Question</td>
						<td class="truncate">@problem.Answer</td>
					</tr>
				}
				</tbody>
			</table>
		</div>
		<button class="btn rounded-lg w-full" onclick="finalize_modal.showModal()"
		        disabled="@(flashCardProblems.Count == 0)">
			Finalize Cards
		</button>
	</div>
</div>
<dialog id="aaaaaa" class="modal modal-bottom sm:modal-middle">
	<div class="modal-box">
		<form>
			<h3 class="text-lg font-bold">New Card</h3>
			<div class="flex flex-col gap-5 py-3">
				<textarea class="textarea textarea-bordered" placeholder="Question" @onchange="HandleQuestionChange"
				          required></textarea>
				<textarea class="textarea textarea-bordered" placeholder="Answer" @onchange="HandleAnswerChange"
				          required></textarea>
			</div>
			<div class="flex flex-row justify-between">
				<div onclick="aaaaaa.close()">
					<button type="button" class="btn btn-sm btn-error text-white rounded-md"
					        @onclick="HandleDiscard">
						Discard
					</button>
				</div>
				<button class="btn btn-sm btn-success rounded-md" @onclick="HandleSave">Save</button>
			</div>
		</form>
	</div>
</dialog>

<!-- Finalize Modal -->
<dialog id="finalize_modal" class="modal modal-bottom sm:modal-middle">
	<div class="modal-box">
		<h3 class="text-lg font-bold">Finalize Deck</h3>
		<div class="py-4">
			<p>Are you sure you want to create this deck with @flashCardProblems.Count cards?</p>
			<div class="mt-2">
				<p><strong>Deck Name:</strong> @DeckName</p>
				<p><strong>Category:</strong> @SelectedCategory</p>
			</div>
			<div class="mt-4">
				<p><strong>Visibility:</strong></p>
				<div class="flex gap-4">
					<label class="cursor-pointer">
						<input type="radio" name="visibility" checked="@(deckVisibility == true)"
						       @onclick="@(() => deckVisibility = true)" class="radio"/> Public
					</label>
					<label class="cursor-pointer">
						<input type="radio" name="visibility" checked="@(deckVisibility == false)"
						       @onclick="@(() => deckVisibility = false)" class="radio"/> Private
					</label>
				</div>
			</div>
		</div>
		<div class="modal-action">
			<form method="dialog" class="flex gap-2">
				<button class="btn btn-ghost" onclick="finalize_modal.close()">Cancel</button>
				<button class="btn btn-primary" @onclick="HandleFinalize" disabled="@isSubmitting">
					@if (isSubmitting)
					{
						<span class="loading loading-spinner"></span>
					}
					Create Deck
				</button>
			</form>
		</div>
	</div>
</dialog>

debug deckName: @DeckName
<br>
debug selectedCategory: @SelectedCategory
<br>
debug tempQuestion: @tempQuestion
<br>
debug tempAnswer: @tempAnswer
<br>
debug flashCardProblemsLength: @flashCardProblems.Count
<ul>
	@for (int i = 0; i < flashCardProblems.Count; i++)
	{
		var problem = flashCardProblems[i];
		<li>
			<strong>Index:</strong> @i <br/>
			<strong>Question:</strong> @problem.Question <br/>
			<strong>Answer:</strong> @problem.Answer
		</li>
	}
</ul>